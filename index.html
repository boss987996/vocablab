<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VocabLab - TOEIC Vocabulary Learning</title>
  <meta name="description" content="Learn TOEIC vocabulary with spaced repetition and AI assistance">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #0f1419; 
      color: #e8ecf0; 
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
// ============================================
// VOCABLAB - TOEIC Vocabulary Learning App
// Using Google Gemini API (FREE!)
// ============================================

const { useState, useEffect, useMemo } = React;

// Configuration
const INTERVALS = [1, 3, 7, 30];
const MIN_EASE_FACTOR = 1.3;
const DEFAULT_EASE_FACTOR = 2.5;

// Database Layer (localStorage)
const DB = {
  getDecks: () => JSON.parse(localStorage.getItem('vocablab_decks') || '[]'),
  saveDecks: (decks) => localStorage.setItem('vocablab_decks', JSON.stringify(decks)),
  getCards: () => JSON.parse(localStorage.getItem('vocablab_cards') || '[]'),
  saveCards: (cards) => localStorage.setItem('vocablab_cards', JSON.stringify(cards)),
  getReviews: () => JSON.parse(localStorage.getItem('vocablab_reviews') || '[]'),
  saveReviews: (reviews) => localStorage.setItem('vocablab_reviews', JSON.stringify(reviews)),
  getStats: () => JSON.parse(localStorage.getItem('vocablab_stats') || '{"streak":0,"lastStudyDate":null,"totalReviews":0}'),
  saveStats: (stats) => localStorage.setItem('vocablab_stats', JSON.stringify(stats)),
  getApiKey: () => localStorage.getItem('vocablab_gemini_key') || '',
  saveApiKey: (key) => localStorage.setItem('vocablab_gemini_key', key),
};

// ============================================
// AI Service with Google Gemini API (FREE!)
// ============================================
const AIService = {
  cache: new Map(),
  
  async callGemini(prompt, apiKey) {
    if (!apiKey) {
      throw new Error('API Key not set');
    }
    
    // Try multiple models in order of preference
    const models = [
      'gemini-2.0-flash',
      'gemini-1.5-flash-8b', 
      'gemini-1.5-pro'
    ];
    
    let lastError = null;
    
    for (const model of models) {
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{ text: prompt }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 200,
            }
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response';
        }
        
        const error = await response.json();
        lastError = error.error?.message || 'API request failed';
        
        // If quota exceeded or model not found, try next model
        if (lastError.includes('quota') || lastError.includes('not found') || lastError.includes('not supported')) {
          console.log(`Model ${model} failed, trying next...`);
          continue;
        }
        
        // Other errors, throw immediately
        throw new Error(lastError);
        
      } catch (e) {
        lastError = e.message;
        continue;
      }
    }
    
    throw new Error(lastError || 'All models failed');
  },
  
  async generateExample(word, meaning, apiKey) {
    const cacheKey = `example_${word}`;
    if (this.cache.has(cacheKey)) return this.cache.get(cacheKey);
    
    const prompt = `Create ONE short example sentence (max 15 words) using the word "${word}" (meaning: ${meaning}) in a TOEIC business/workplace context. Return ONLY the sentence, no explanation, no quotes.`;
    
    try {
      const result = await this.callGemini(prompt, apiKey);
      const cleanResult = result.trim().replace(/^["']|["']$/g, '');
      this.cache.set(cacheKey, cleanResult);
      return cleanResult;
    } catch (error) {
      console.error('Gemini API error:', error);
      return this.mockExample(word);
    }
  },
  
  async explainMeaning(word, meaning, apiKey) {
    const cacheKey = `explain_${word}`;
    if (this.cache.has(cacheKey)) return this.cache.get(cacheKey);
    
    const prompt = `Explain "${word}" (${meaning}) briefly for TOEIC learners in 1-2 sentences. Include when/how it's commonly used in business English. Return ONLY the explanation.`;
    
    try {
      const result = await this.callGemini(prompt, apiKey);
      this.cache.set(cacheKey, result.trim());
      return result.trim();
    } catch (error) {
      console.error('Gemini API error:', error);
      return this.mockExplanation(word, meaning);
    }
  },
  
  // Fallback mock functions
  mockExample(word) {
    const templates = [
      `The manager asked the team to ${word.toLowerCase()} the project timeline.`,
      `We need to ${word.toLowerCase()} our quarterly goals effectively.`,
      `Please ${word.toLowerCase()} the document before the meeting.`,
    ];
    return templates[Math.floor(Math.random() * templates.length)];
  },
  
  mockExplanation(word, meaning) {
    return `"${word}" means ${meaning}. This word is commonly used in business correspondence and workplace discussions.`;
  },
  
  async getFamiliarVocab(word, meaning, apiKey) {
    const cacheKey = `familiar_${word}`;
    if (this.cache.has(cacheKey)) return this.cache.get(cacheKey);
    
    const prompt = `For the English word "${word}" (meaning: ${meaning}), list exactly 5 related words/synonyms commonly used in TOEIC and business English.

Format each word EXACTLY like this (one per line):
Word (part of speech) - Thai meaning

Example format:
Standard (noun) - ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
Requirement (noun) - ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î

Return ONLY the 5 words in this exact format, no numbering, no extra text.`;
    
    try {
      const result = await this.callGemini(prompt, apiKey);
      const cleanResult = result.trim();
      this.cache.set(cacheKey, cleanResult);
      return cleanResult;
    } catch (error) {
      console.error('Gemini API error:', error);
      return this.mockFamiliarVocab(word);
    }
  },
  
  mockFamiliarVocab(word) {
    return `Similar (adjective) - ‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏Ñ‡∏•‡∏∂‡∏á
Related (adjective) - ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
Equivalent (noun) - ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤
Comparable (adjective) - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÑ‡∏î‡πâ
Corresponding (adjective) - ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á`;
  }
};

// SRS Logic
function calculateNextReview(card, quality) {
  let { repetitions = 0, intervalIndex = 0, easeFactor = DEFAULT_EASE_FACTOR } = card;
  
  if (quality < 2) {
    repetitions = 0;
    intervalIndex = 0;
  } else {
    repetitions += 1;
    if (repetitions === 1) intervalIndex = 0;
    else if (repetitions === 2) intervalIndex = 1;
    else intervalIndex = Math.min(intervalIndex + 1, INTERVALS.length - 1);
  }
  
  const q = quality + 2;
  easeFactor = Math.max(MIN_EASE_FACTOR, easeFactor + (0.1 - (5 - q) * (0.08 + (5 - q) * 0.02)));
  
  if (quality === 3) intervalIndex = Math.min(intervalIndex + 1, INTERVALS.length - 1);
  
  const days = INTERVALS[intervalIndex];
  const nextReviewAt = new Date();
  nextReviewAt.setDate(nextReviewAt.getDate() + days);
  
  return { repetitions, intervalIndex, easeFactor: Math.round(easeFactor * 100) / 100, nextReviewAt: nextReviewAt.toISOString(), lastInterval: days };
}

function isDue(card) {
  if (!card.nextReviewAt) return true;
  return new Date(card.nextReviewAt) <= new Date();
}

// CSV Parser
function parseCSV(text) {
  const lines = text.trim().split('\n');
  const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
  
  return lines.slice(1).map(line => {
    const values = line.split(',').map(v => v.trim());
    const card = {};
    headers.forEach((header, i) => {
      if (header === 'word' || header === 'front') card.front = values[i] || '';
      else if (header === 'meaning_th' || header === 'back') card.back = values[i] || '';
      else if (header === 'meaning_en') card.meaningEn = values[i] || '';
      else if (header === 'example') card.example = values[i] || '';
      else if (header === 'phonetic') card.phonetic = values[i] || '';
      else if (header === 'category' || header === 'tags') card.tags = values[i] || '';
    });
    return card;
  }).filter(c => c.front && c.back);
}

const generateId = () => Math.random().toString(36).substr(2, 9);
const formatDate = (date) => new Date(date).toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });

// ============================================
// Main App Component
// ============================================
function VocabLabApp() {
  const [view, setView] = useState('library');
  const [decks, setDecks] = useState([]);
  const [cards, setCards] = useState([]);
  const [reviews, setReviews] = useState([]);
  const [stats, setStats] = useState({ streak: 0, lastStudyDate: null, totalReviews: 0 });
  const [selectedDeck, setSelectedDeck] = useState(null);
  const [studyCards, setStudyCards] = useState([]);
  const [currentCardIndex, setCurrentCardIndex] = useState(0);
  const [showAnswer, setShowAnswer] = useState(false);
  const [aiLoading, setAiLoading] = useState(false);
  const [aiContent, setAiContent] = useState({ example: '', explanation: '', familiarVocab: '' });
  const [notification, setNotification] = useState(null);
  const [apiKey, setApiKey] = useState('');
  const [showSettings, setShowSettings] = useState(false);

  // Load data
  useEffect(() => {
    setDecks(DB.getDecks());
    setCards(DB.getCards());
    setReviews(DB.getReviews());
    setStats(DB.getStats());
    setApiKey(DB.getApiKey());
  }, []);

  // Auto-save
  useEffect(() => { DB.saveDecks(decks); }, [decks]);
  useEffect(() => { DB.saveCards(cards); }, [cards]);
  useEffect(() => { DB.saveReviews(reviews); }, [reviews]);
  useEffect(() => { DB.saveStats(stats); }, [stats]);

  // Keyboard shortcuts
  useEffect(() => {
    const handleKeyPress = (e) => {
      if (view !== 'study' || !studyCards.length) return;
      if (!showAnswer) {
        if (e.code === 'Space' || e.code === 'Enter') {
          e.preventDefault();
          setShowAnswer(true);
        }
      } else {
        if (e.key === '1') handleReview(0);
        else if (e.key === '2') handleReview(1);
        else if (e.key === '3') handleReview(2);
        else if (e.key === '4') handleReview(3);
      }
    };
    window.addEventListener('keydown', handleKeyPress);
    return () => window.removeEventListener('keydown', handleKeyPress);
  }, [view, showAnswer, studyCards, currentCardIndex]);

  const showNotification = (message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  };

  const dueCards = useMemo(() => cards.filter(isDue), [cards]);
  const todayReviews = useMemo(() => {
    const today = new Date().toDateString();
    return reviews.filter(r => new Date(r.reviewedAt).toDateString() === today);
  }, [reviews]);

  // Deck operations
  const createDeck = (title) => {
    const deck = { id: generateId(), title, createdAt: new Date().toISOString() };
    setDecks([...decks, deck]);
    showNotification(`‡∏™‡∏£‡πâ‡∏≤‡∏á "${title}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
  };

  // Card operations
  const addCard = (deckId, cardData) => {
    const card = {
      id: generateId(), deckId, ...cardData,
      repetitions: 0, intervalIndex: 0, easeFactor: DEFAULT_EASE_FACTOR,
      nextReviewAt: new Date().toISOString(), createdAt: new Date().toISOString()
    };
    setCards([...cards, card]);
  };

  const updateCard = (cardId, updates) => {
    setCards(cards.map(c => c.id === cardId ? { ...c, ...updates } : c));
  };

  const deleteCard = (cardId) => {
    setCards(cards.filter(c => c.id !== cardId));
  };

  const importCards = (deckId, csvText) => {
    const parsed = parseCSV(csvText);
    const newCards = parsed.map(c => ({
      id: generateId(), deckId, front: c.front, back: c.back,
      example: c.example || '', phonetic: c.phonetic || '', tags: c.tags || '',
      repetitions: 0, intervalIndex: 0, easeFactor: DEFAULT_EASE_FACTOR,
      nextReviewAt: new Date().toISOString(), createdAt: new Date().toISOString()
    }));
    setCards([...cards, ...newCards]);
    showNotification(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ${newCards.length} ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
  };

  // Study operations
  const startStudy = (deckId = null) => {
    let cardsToStudy = deckId ? cards.filter(c => c.deckId === deckId && isDue(c)) : dueCards;
    cardsToStudy = cardsToStudy.sort(() => Math.random() - 0.5);
    if (cardsToStudy.length === 0) {
      showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô', 'info');
      return;
    }
    setStudyCards(cardsToStudy);
    setCurrentCardIndex(0);
    setShowAnswer(false);
    setAiContent({ example: '', explanation: '' });
    setView('study');
  };

  const handleReview = (quality) => {
    const card = studyCards[currentCardIndex];
    const updates = calculateNextReview(card, quality);
    updateCard(card.id, updates);
    
    setReviews([...reviews, {
      id: generateId(), cardId: card.id, quality,
      intervalDays: updates.lastInterval, reviewedAt: new Date().toISOString()
    }]);
    
    const today = new Date().toDateString();
    const newStats = { ...stats, totalReviews: stats.totalReviews + 1 };
    if (stats.lastStudyDate !== today) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      newStats.streak = stats.lastStudyDate === yesterday.toDateString() ? stats.streak + 1 : 1;
      newStats.lastStudyDate = today;
    }
    setStats(newStats);
    
    if (currentCardIndex < studyCards.length - 1) {
      setCurrentCardIndex(currentCardIndex + 1);
      setShowAnswer(false);
      setAiContent({ example: '', explanation: '', familiarVocab: '' });
    } else {
      showNotification('‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üéâ');
      setView('dashboard');
    }
  };

  // AI operations (using Gemini)
  const generateExample = async () => {
    const card = studyCards[currentCardIndex];
    setAiLoading(true);
    try {
      const example = await AIService.generateExample(card.front, card.back, apiKey);
      setAiContent(prev => ({ ...prev, example }));
      updateCard(card.id, { aiExample: example });
    } catch (e) {
      if (!apiKey) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key ‡∏Å‡πà‡∏≠‡∏ô', 'error');
        setShowSettings(true);
      } else {
        showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: ' + e.message, 'error');
      }
    }
    setAiLoading(false);
  };

  const explainMeaning = async () => {
    const card = studyCards[currentCardIndex];
    setAiLoading(true);
    try {
      const explanation = await AIService.explainMeaning(card.front, card.back, apiKey);
      setAiContent(prev => ({ ...prev, explanation }));
    } catch (e) {
      if (!apiKey) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key ‡∏Å‡πà‡∏≠‡∏ô', 'error');
        setShowSettings(true);
      } else {
        showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ' + e.message, 'error');
      }
    }
    setAiLoading(false);
  };

  const getFamiliarVocab = async () => {
    const card = studyCards[currentCardIndex];
    setAiLoading(true);
    try {
      const familiarVocab = await AIService.getFamiliarVocab(card.front, card.back, apiKey);
      setAiContent(prev => ({ ...prev, familiarVocab }));
      updateCard(card.id, { aiFamiliarVocab: familiarVocab });
    } catch (e) {
      if (!apiKey) {
        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key ‡∏Å‡πà‡∏≠‡∏ô', 'error');
        setShowSettings(true);
      } else {
        showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + e.message, 'error');
      }
    }
    setAiLoading(false);
  };

  const saveApiKey = (key) => {
    setApiKey(key);
    DB.saveApiKey(key);
    showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Key ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    setShowSettings(false);
  };

  // Test API Key
  const testApiKey = async () => {
    if (!apiKey) {
      showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏Å‡πà‡∏≠‡∏ô', 'error');
      return;
    }
    setAiLoading(true);
    try {
      await AIService.callGemini('Say "Hello" in one word.', apiKey);
      showNotification('‚úÖ API Key ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ!', 'success');
    } catch (e) {
      showNotification('‚ùå API Key ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ' + e.message, 'error');
    }
    setAiLoading(false);
  };

  // Styles
  const s = {
    app: { minHeight: '100vh', display: 'flex', flexDirection: 'column' },
    header: { background: '#1a1f26', borderBottom: '1px solid #30363d', padding: '0 24px', position: 'sticky', top: 0, zIndex: 100 },
    headerContent: { maxWidth: '1200px', margin: '0 auto', display: 'flex', alignItems: 'center', justifyContent: 'space-between', height: '64px', flexWrap: 'wrap', gap: '12px' },
    logo: { fontSize: '1.5rem', fontWeight: 700, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px', margin: 0 },
    nav: { display: 'flex', gap: '8px', alignItems: 'center' },
    navBtn: { background: 'transparent', border: 'none', color: '#8b949e', padding: '8px 16px', borderRadius: '8px', fontSize: '0.95rem', cursor: 'pointer' },
    navBtnActive: { background: '#242b33', color: '#e8ecf0' },
    studyNowBtn: { background: '#58a6ff', color: 'white', border: 'none', padding: '8px 16px', borderRadius: '8px', fontSize: '0.95rem', cursor: 'pointer' },
    settingsBtn: { background: 'transparent', border: 'none', color: '#8b949e', fontSize: '1.2rem', cursor: 'pointer', padding: '8px' },
    main: { flex: 1, maxWidth: '1200px', margin: '0 auto', padding: '32px 24px', width: '100%' },
    btn: { background: '#58a6ff', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '8px', fontSize: '0.95rem', cursor: 'pointer' },
    btnSec: { background: '#242b33', color: '#e8ecf0', border: '1px solid #30363d', padding: '10px 20px', borderRadius: '8px', cursor: 'pointer' },
    btnGhost: { background: 'transparent', color: '#8b949e', border: 'none', padding: '8px 16px', borderRadius: '8px', cursor: 'pointer' },
    btnGreen: { background: '#238636', color: 'white', border: 'none', padding: '10px 20px', borderRadius: '8px', cursor: 'pointer' },
    viewHeader: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '32px', gap: '16px', flexWrap: 'wrap' },
    title: { fontSize: '1.8rem', fontWeight: 600, margin: 0 },
    empty: { textAlign: 'center', padding: '80px 20px', color: '#8b949e' },
    emptyIcon: { fontSize: '4rem', display: 'block', marginBottom: '16px' },
    deckGrid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '20px' },
    deckCard: { background: '#1a1f26', border: '1px solid #30363d', borderRadius: '12px', overflow: 'hidden' },
    deckInfo: { padding: '24px', cursor: 'pointer' },
    deckActions: { padding: '16px 24px', background: '#242b33', display: 'flex', gap: '12px' },
    dueBadge: { display: 'inline-block', background: '#d29922', color: '#0f1419', padding: '4px 10px', borderRadius: '12px', fontSize: '0.8rem', fontWeight: 600, marginTop: '12px' },
    modal: { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.7)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 200, padding: '20px' },
    modalBox: { background: '#1a1f26', border: '1px solid #30363d', borderRadius: '16px', padding: '28px', width: '100%', maxWidth: '500px', maxHeight: '90vh', overflow: 'auto' },
    input: { width: '100%', background: '#242b33', border: '1px solid #30363d', borderRadius: '8px', padding: '12px 16px', color: '#e8ecf0', fontSize: '1rem', boxSizing: 'border-box', marginBottom: '16px' },
    textarea: { width: '100%', background: '#242b33', border: '1px solid #30363d', borderRadius: '8px', padding: '12px', color: '#e8ecf0', fontSize: '0.9rem', fontFamily: 'monospace', boxSizing: 'border-box' },
    label: { display: 'block', fontSize: '0.9rem', color: '#8b949e', marginBottom: '6px' },
    modalActions: { display: 'flex', justifyContent: 'flex-end', gap: '12px', marginTop: '24px' },
    cardList: { display: 'flex', flexDirection: 'column', gap: '12px' },
    cardItem: { background: '#1a1f26', border: '1px solid #30363d', borderRadius: '8px', padding: '16px 20px', display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: '16px', flexWrap: 'wrap' },
    statusDue: { background: 'rgba(248, 81, 73, 0.2)', color: '#f85149', padding: '4px 10px', borderRadius: '4px', fontSize: '0.8rem' },
    statusOk: { background: 'rgba(63, 185, 80, 0.2)', color: '#3fb950', padding: '4px 10px', borderRadius: '4px', fontSize: '0.8rem' },
    studyView: { maxWidth: '700px', margin: '0 auto' },
    studyHeader: { display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '40px' },
    progressBar: { flex: 1, height: '6px', background: '#242b33', borderRadius: '3px', overflow: 'hidden' },
    progressFill: { height: '100%', background: '#58a6ff', transition: 'width 0.3s' },
    flashcard: { width: '100%', minHeight: '320px', background: '#1a1f26', border: '1px solid #30363d', borderRadius: '16px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '40px', textAlign: 'center', marginBottom: '32px' },
    cardWord: { fontSize: '2.5rem', fontWeight: 600, marginBottom: '8px' },
    cardPhonetic: { color: '#8b949e', fontSize: '1.1rem' },
    flipHint: { color: '#8b949e', fontSize: '0.9rem', marginTop: '24px' },
    cardMeaning: { fontSize: '1.8rem', marginBottom: '16px' },
    cardExample: { color: '#8b949e', fontStyle: 'italic' },
    aiSection: { display: 'flex', gap: '12px', justifyContent: 'center', marginBottom: '20px', flexWrap: 'wrap' },
    aiBtn: { background: '#242b33', border: '1px solid #30363d', color: '#e8ecf0', padding: '10px 20px', borderRadius: '8px', cursor: 'pointer' },
    aiContent: { background: '#242b33', borderRadius: '12px', padding: '16px 20px', marginBottom: '24px' },
    reviewBtns: { display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '12px' },
    reviewBtn: { display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '16px 8px', border: 'none', borderRadius: '12px', fontSize: '0.95rem', fontWeight: 500, cursor: 'pointer' },
    statsGrid: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(160px, 1fr))', gap: '16px', marginBottom: '40px' },
    statCard: { background: '#1a1f26', border: '1px solid #30363d', borderRadius: '12px', padding: '24px', textAlign: 'center' },
    statHighlight: { background: 'linear-gradient(135deg, rgba(248, 81, 73, 0.1), rgba(210, 153, 34, 0.1))', border: '1px solid rgba(210, 153, 34, 0.3)' },
    statIcon: { fontSize: '1.8rem', display: 'block', marginBottom: '8px' },
    statValue: { fontSize: '2.5rem', fontWeight: 700, display: 'block' },
    statLabel: { fontSize: '0.9rem', color: '#8b949e' },
    chartSection: { background: '#1a1f26', border: '1px solid #30363d', borderRadius: '12px', padding: '24px', marginBottom: '32px' },
    weekChart: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', height: '160px', gap: '8px' },
    chartBar: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', height: '100%' },
    barFill: { width: '100%', maxWidth: '48px', borderRadius: '4px 4px 0 0', marginTop: 'auto', minHeight: '4px', position: 'relative' },
    barValue: { position: 'absolute', top: '-24px', fontSize: '0.8rem', fontWeight: 600, left: '50%', transform: 'translateX(-50%)' },
    barLabel: { fontSize: '0.8rem', marginTop: '8px' },
    doneMsg: { textAlign: 'center', padding: '48px', background: '#1a1f26', borderRadius: '12px' },
    notif: { position: 'fixed', bottom: '24px', right: '24px', background: '#1a1f26', border: '1px solid #30363d', padding: '14px 24px', borderRadius: '8px', zIndex: 300, boxShadow: '0 4px 24px rgba(0,0,0,0.4)' },
    apiStatus: { display: 'flex', alignItems: 'center', gap: '6px', fontSize: '0.85rem', padding: '8px 12px', borderRadius: '6px', marginBottom: '16px' },
    infoBox: { background: '#1c2128', border: '1px solid #30363d', borderRadius: '8px', padding: '16px', marginBottom: '20px', fontSize: '0.9rem' },
  };

  // ============================================
  // RENDER COMPONENTS
  // ============================================

  const Header = () => (
    <header style={s.header}>
      <div style={s.headerContent}>
        <h1 style={s.logo} onClick={() => setView('library')}>üìö VocabLab</h1>
        <nav style={s.nav}>
          <button style={{...s.navBtn, ...(view === 'library' ? s.navBtnActive : {})}} onClick={() => setView('library')}>Library</button>
          <button style={{...s.navBtn, ...(view === 'dashboard' ? s.navBtnActive : {})}} onClick={() => setView('dashboard')}>Dashboard</button>
          {dueCards.length > 0 && <button style={s.studyNowBtn} onClick={() => startStudy()}>Study ({dueCards.length})</button>}
          <button style={s.settingsBtn} onClick={() => setShowSettings(true)} title="Settings">‚öôÔ∏è</button>
        </nav>
      </div>
    </header>
  );

  const SettingsModal = () => (
    <div style={s.modal} onClick={() => setShowSettings(false)}>
      <div style={s.modalBox} onClick={e => e.stopPropagation()}>
        <h3 style={{margin: '0 0 20px'}}>‚öôÔ∏è Settings</h3>
        
        <div style={s.infoBox}>
          <strong style={{color: '#3fb950'}}>üéâ ‡πÉ‡∏ä‡πâ Google Gemini API ‡∏ü‡∏£‡∏µ!</strong>
          <p style={{margin: '8px 0 0', color: '#8b949e'}}>
            ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï ‚Ä¢ 1,500 requests/‡∏ß‡∏±‡∏ô
          </p>
        </div>
        
        <div style={{marginBottom: '20px'}}>
          <label style={s.label}>Google Gemini API Key</label>
          <input
            type="password"
            placeholder="AIzaSy..."
            value={apiKey}
            onChange={e => setApiKey(e.target.value)}
            style={s.input}
          />
          
          <div style={{...s.apiStatus, background: apiKey ? 'rgba(63,185,80,0.1)' : 'rgba(248,81,73,0.1)', color: apiKey ? '#3fb950' : '#f85149'}}>
            {apiKey ? '‚úì ‡∏°‡∏µ API Key ‡πÅ‡∏•‡πâ‡∏ß' : '‚úó ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Key'}
          </div>
          
          <div style={{background: '#1c2128', padding: '16px', borderRadius: '8px', marginBottom: '16px'}}>
            <p style={{fontSize: '0.9rem', color: '#8b949e', margin: '0 0 12px'}}>
              <strong style={{color: '#e8ecf0'}}>‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö API Key (‡∏ü‡∏£‡∏µ!):</strong>
            </p>
            <ol style={{fontSize: '0.85rem', color: '#8b949e', margin: 0, paddingLeft: '20px', lineHeight: 1.8}}>
              <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://aistudio.google.com" target="_blank" style={{color: '#58a6ff'}}>aistudio.google.com</a></li>
              <li>Login ‡∏î‡πâ‡∏ß‡∏¢ Google Account</li>
              <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>"Get API key"</strong> ‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢</li>
              <li>‡∏Ñ‡∏•‡∏¥‡∏Å <strong>"Create API key"</strong></li>
              <li>Copy key ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</li>
            </ol>
          </div>
        </div>
        
        <div style={s.modalActions}>
          <button style={s.btnSec} onClick={testApiKey} disabled={aiLoading}>
            {aiLoading ? '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...' : 'üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Key'}
          </button>
          <button style={s.btnGhost} onClick={() => setShowSettings(false)}>Cancel</button>
          <button style={s.btnGreen} onClick={() => saveApiKey(apiKey)}>üíæ Save</button>
        </div>
      </div>
    </div>
  );

  const LibraryView = () => {
    const [showCreate, setShowCreate] = useState(false);
    const [title, setTitle] = useState('');
    
    return (
      <div>
        <div style={s.viewHeader}>
          <h2 style={s.title}>Your Library</h2>
          <button style={s.btn} onClick={() => setShowCreate(true)}>+ New Deck</button>
        </div>
        
        {decks.length === 0 ? (
          <div style={s.empty}>
            <span style={s.emptyIcon}>üìñ</span>
            <h3 style={{color: '#e8ecf0', marginBottom: '8px'}}>No decks yet</h3>
            <p style={{marginBottom: '24px'}}>Create your first deck to start learning</p>
            <button style={s.btn} onClick={() => setShowCreate(true)}>Create Deck</button>
          </div>
        ) : (
          <div style={s.deckGrid}>
            {decks.map(deck => {
              const deckCards = cards.filter(c => c.deckId === deck.id);
              const deckDue = deckCards.filter(isDue).length;
              return (
                <div key={deck.id} style={s.deckCard}>
                  <div style={s.deckInfo} onClick={() => { setSelectedDeck(deck); setView('deck'); }}>
                    <h3 style={{margin: '0 0 8px'}}>{deck.title}</h3>
                    <p style={{color: '#8b949e', margin: 0}}>{deckCards.length} cards</p>
                    {deckDue > 0 && <span style={s.dueBadge}>{deckDue} due</span>}
                  </div>
                  <div style={s.deckActions}>
                    <button style={s.btnSec} onClick={() => startStudy(deck.id)} disabled={deckDue === 0}>Study</button>
                    <button style={s.btnGhost} onClick={() => { setSelectedDeck(deck); setView('deck'); }}>Edit</button>
                  </div>
                </div>
              );
            })}
          </div>
        )}
        
        {showCreate && (
          <div style={s.modal} onClick={() => setShowCreate(false)}>
            <div style={s.modalBox} onClick={e => e.stopPropagation()}>
              <h3 style={{margin: '0 0 20px'}}>Create New Deck</h3>
              <input placeholder="Deck name (e.g., TOEIC Part 5)" value={title} onChange={e => setTitle(e.target.value)} style={s.input} autoFocus />
              <div style={s.modalActions}>
                <button style={s.btnGhost} onClick={() => setShowCreate(false)}>Cancel</button>
                <button style={s.btn} onClick={() => { if(title.trim()) { createDeck(title.trim()); setTitle(''); setShowCreate(false); } }}>Create</button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const DeckView = () => {
    const [showAdd, setShowAdd] = useState(false);
    const [showImport, setShowImport] = useState(false);
    const [newCard, setNewCard] = useState({ front: '', back: '', example: '', phonetic: '' });
    const [csv, setCsv] = useState('');
    
    if (!selectedDeck) return null;
    const deckCards = cards.filter(c => c.deckId === selectedDeck.id);
    
    return (
      <div>
        <div style={s.viewHeader}>
          <button style={s.btnGhost} onClick={() => setView('library')}>‚Üê Back</button>
          <h2 style={s.title}>{selectedDeck.title}</h2>
          <div style={{display: 'flex', gap: '12px'}}>
            <button style={s.btnSec} onClick={() => setShowImport(true)}>Import CSV</button>
            <button style={s.btn} onClick={() => setShowAdd(true)}>+ Add Card</button>
          </div>
        </div>
        
        {deckCards.length === 0 ? (
          <div style={s.empty}>
            <span style={s.emptyIcon}>‚ú®</span>
            <h3 style={{color: '#e8ecf0', marginBottom: '8px'}}>No cards yet</h3>
            <p style={{marginBottom: '24px'}}>Add vocabulary cards or import from CSV</p>
            <div style={{display: 'flex', gap: '12px', justifyContent: 'center'}}>
              <button style={s.btn} onClick={() => setShowAdd(true)}>Add Card</button>
              <button style={s.btnSec} onClick={() => setShowImport(true)}>Import CSV</button>
            </div>
          </div>
        ) : (
          <>
            <div style={{...s.cardItem, marginBottom: '24px', background: '#242b33'}}>
              <span>{deckCards.length} cards</span>
              <span>{deckCards.filter(isDue).length} due</span>
              <button style={{...s.btn, marginLeft: 'auto'}} onClick={() => startStudy(selectedDeck.id)} disabled={deckCards.filter(isDue).length === 0}>Start Study</button>
            </div>
            <div style={s.cardList}>
              {deckCards.map(card => (
                <div key={card.id} style={s.cardItem}>
                  <div style={{flex: 1}}>
                    <div style={{marginBottom: '4px'}}><strong>{card.front}</strong> {card.phonetic && <span style={{color: '#8b949e'}}>{card.phonetic}</span>}</div>
                    <div style={{color: '#8b949e'}}>{card.back}</div>
                    {card.example && <div style={{color: '#8b949e', fontStyle: 'italic', marginTop: '8px'}}>"{card.example}"</div>}
                  </div>
                  <div style={{display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '8px'}}>
                    <span style={isDue(card) ? s.statusDue : s.statusOk}>{isDue(card) ? 'Due' : `Next: ${formatDate(card.nextReviewAt)}`}</span>
                    <button style={{...s.btnGhost, color: '#f85149'}} onClick={() => deleteCard(card.id)}>Delete</button>
                  </div>
                </div>
              ))}
            </div>
          </>
        )}
        
        {showAdd && (
          <div style={s.modal} onClick={() => setShowAdd(false)}>
            <div style={s.modalBox} onClick={e => e.stopPropagation()}>
              <h3 style={{margin: '0 0 20px'}}>Add New Card</h3>
              <label style={s.label}>Word</label>
              <input placeholder="e.g., accomplish" value={newCard.front} onChange={e => setNewCard({...newCard, front: e.target.value})} style={s.input} />
              <label style={s.label}>Meaning (Thai)</label>
              <input placeholder="e.g., ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" value={newCard.back} onChange={e => setNewCard({...newCard, back: e.target.value})} style={s.input} />
              <label style={s.label}>Example (optional)</label>
              <input placeholder="e.g., We accomplished our goals." value={newCard.example} onChange={e => setNewCard({...newCard, example: e.target.value})} style={s.input} />
              <label style={s.label}>Phonetic (optional)</label>
              <input placeholder="e.g., /…ôÀàk…ëÀêmpl…™ É/" value={newCard.phonetic} onChange={e => setNewCard({...newCard, phonetic: e.target.value})} style={s.input} />
              <div style={s.modalActions}>
                <button style={s.btnGhost} onClick={() => setShowAdd(false)}>Cancel</button>
                <button style={s.btn} onClick={() => { if(newCard.front && newCard.back) { addCard(selectedDeck.id, newCard); setNewCard({front:'',back:'',example:'',phonetic:''}); setShowAdd(false); showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } }}>Add</button>
              </div>
            </div>
          </div>
        )}
        
        {showImport && (
          <div style={s.modal} onClick={() => setShowImport(false)}>
            <div style={s.modalBox} onClick={e => e.stopPropagation()}>
              <h3 style={{margin: '0 0 20px'}}>Import from CSV</h3>
              <p style={{color: '#8b949e', fontSize: '0.9rem', marginBottom: '16px'}}>Format: word,meaning_th,example,phonetic</p>
              <textarea placeholder={`word,meaning_th,example\naccomplish,‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à,We accomplished our goals.\nnegotiate,‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á,They negotiated a deal.`} value={csv} onChange={e => setCsv(e.target.value)} style={s.textarea} rows={8} />
              <div style={s.modalActions}>
                <button style={s.btnGhost} onClick={() => setShowImport(false)}>Cancel</button>
                <button style={s.btn} onClick={() => { if(csv.trim()) { importCards(selectedDeck.id, csv); setCsv(''); setShowImport(false); } }}>Import</button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const StudyView = () => {
    if (studyCards.length === 0) return <div style={s.empty}><h3>No cards</h3><button style={s.btn} onClick={() => setView('library')}>Back</button></div>;
    
    const card = studyCards[currentCardIndex];
    const progress = ((currentCardIndex + 1) / studyCards.length) * 100;
    
    return (
      <div style={s.studyView}>
        <div style={s.studyHeader}>
          <button style={s.btnGhost} onClick={() => setView('library')}>‚úï Exit</button>
          <span style={{color: '#8b949e'}}>{currentCardIndex + 1} / {studyCards.length}</span>
          <div style={s.progressBar}><div style={{...s.progressFill, width: `${progress}%`}} /></div>
        </div>
        
        <div style={{...s.flashcard, cursor: !showAnswer ? 'pointer' : 'default'}} onClick={() => !showAnswer && setShowAnswer(true)}>
          {!showAnswer ? (
            <>
              <span style={s.cardWord}>{card.front}</span>
              {card.phonetic && <span style={s.cardPhonetic}>{card.phonetic}</span>}
              <span style={s.flipHint}>Click or press Space to reveal</span>
            </>
          ) : (
            <>
              <span style={s.cardMeaning}>{card.back}</span>
              {card.example && <p style={s.cardExample}>"{card.example}"</p>}
            </>
          )}
        </div>
        
        {showAnswer && (
          <>
            <div style={s.aiSection}>
              <button style={s.aiBtn} onClick={generateExample} disabled={aiLoading}>
                {aiLoading ? '‚è≥' : '‚ú®'} Generate Example
              </button>
              <button style={s.aiBtn} onClick={explainMeaning} disabled={aiLoading}>
                {aiLoading ? '‚è≥' : 'üí°'} Explain Meaning
              </button>
              <button style={s.aiBtn} onClick={getFamiliarVocab} disabled={aiLoading}>
                {aiLoading ? '‚è≥' : 'üîó'} Familiar Vocab
              </button>
            </div>
            
            {(aiContent.example || aiContent.explanation || aiContent.familiarVocab) && (
              <div style={s.aiContent}>
                {aiContent.example && <p style={{margin: '0 0 12px', color: '#8b949e'}}><strong style={{color: '#a371f7'}}>Example:</strong> {aiContent.example}</p>}
                {aiContent.explanation && <p style={{margin: '0 0 12px', color: '#8b949e'}}><strong style={{color: '#a371f7'}}>Explanation:</strong> {aiContent.explanation}</p>}
                {aiContent.familiarVocab && (
                  <div style={{marginTop: aiContent.example || aiContent.explanation ? '16px' : '0', paddingTop: aiContent.example || aiContent.explanation ? '16px' : '0', borderTop: aiContent.example || aiContent.explanation ? '1px solid #30363d' : 'none'}}>
                    <p style={{margin: '0 0 12px', color: '#58a6ff', fontWeight: 600}}>üîó Familiar Vocab (Related Words):</p>
                    <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                      {aiContent.familiarVocab.split('\n').filter(line => line.trim()).map((line, i) => (
                        <div key={i} style={{background: '#1a1f26', border: '1px solid #30363d', borderRadius: '8px', padding: '10px 14px', fontSize: '0.95rem'}}>
                          <span style={{color: '#e8ecf0'}}>{line}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            )}
            
            <div style={s.reviewBtns}>
              <button style={{...s.reviewBtn, background: 'rgba(248,81,73,0.2)', color: '#f85149'}} onClick={() => handleReview(0)}><small style={{opacity: 0.6}}>1</small>Again<small style={{opacity: 0.7}}>1d</small></button>
              <button style={{...s.reviewBtn, background: 'rgba(210,153,34,0.2)', color: '#d29922'}} onClick={() => handleReview(1)}><small style={{opacity: 0.6}}>2</small>Hard<small style={{opacity: 0.7}}>1d</small></button>
              <button style={{...s.reviewBtn, background: 'rgba(63,185,80,0.2)', color: '#3fb950'}} onClick={() => handleReview(2)}><small style={{opacity: 0.6}}>3</small>Good<small style={{opacity: 0.7}}>{INTERVALS[Math.min((card.intervalIndex||0)+1,3)]}d</small></button>
              <button style={{...s.reviewBtn, background: 'rgba(88,166,255,0.2)', color: '#58a6ff'}} onClick={() => handleReview(3)}><small style={{opacity: 0.6}}>4</small>Easy<small style={{opacity: 0.7}}>{INTERVALS[Math.min((card.intervalIndex||0)+2,3)]}d</small></button>
            </div>
          </>
        )}
      </div>
    );
  };

  const DashboardView = () => {
    const weekDays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const today = new Date();
    const weekStats = Array.from({length:7}, (_,i) => {
      const d = new Date(today); d.setDate(d.getDate()-(6-i));
      const count = reviews.filter(r => new Date(r.reviewedAt).toDateString() === d.toDateString()).length;
      return { day: weekDays[d.getDay()], count, isToday: i===6 };
    });
    const maxCount = Math.max(...weekStats.map(s => s.count), 1);
    
    return (
      <div>
        <div style={s.viewHeader}>
          <h2 style={s.title}>Dashboard</h2>
          {dueCards.length > 0 && <button style={s.btn} onClick={() => startStudy()}>Study {dueCards.length} Due Cards</button>}
        </div>
        
        <div style={s.statsGrid}>
          <div style={{...s.statCard, ...s.statHighlight}}><span style={s.statIcon}>üî•</span><span style={s.statValue}>{stats.streak}</span><span style={s.statLabel}>Day Streak</span></div>
          <div style={s.statCard}><span style={s.statIcon}>üìù</span><span style={s.statValue}>{todayReviews.length}</span><span style={s.statLabel}>Today</span></div>
          <div style={s.statCard}><span style={s.statIcon}>üìö</span><span style={s.statValue}>{cards.length}</span><span style={s.statLabel}>Total Cards</span></div>
          <div style={s.statCard}><span style={s.statIcon}>‚è∞</span><span style={s.statValue}>{dueCards.length}</span><span style={s.statLabel}>Due</span></div>
        </div>
        
        <div style={s.chartSection}>
          <h3 style={{color: '#8b949e', margin: '0 0 20px', fontSize: '1rem'}}>This Week</h3>
          <div style={s.weekChart}>
            {weekStats.map((stat,i) => (
              <div key={i} style={s.chartBar}>
                <div style={{...s.barFill, height: `${(stat.count/maxCount)*100}%`, background: stat.isToday ? '#3fb950' : '#58a6ff'}}>
                  {stat.count > 0 && <span style={s.barValue}>{stat.count}</span>}
                </div>
                <span style={{...s.barLabel, color: stat.isToday ? '#3fb950' : '#8b949e'}}>{stat.day}</span>
              </div>
            ))}
          </div>
        </div>
        
        {dueCards.length === 0 && (
          <div style={s.doneMsg}>
            <span style={{fontSize: '3rem', display: 'block', marginBottom: '16px'}}>üéâ</span>
            <h3>All caught up!</h3>
            <p style={{color: '#8b949e'}}>No cards due for review</p>
          </div>
        )}
      </div>
    );
  };

  return (
    <div style={s.app}>
      <Header />
      <main style={s.main}>
        {view === 'library' && <LibraryView />}
        {view === 'deck' && <DeckView />}
        {view === 'study' && <StudyView />}
        {view === 'dashboard' && <DashboardView />}
      </main>
      {showSettings && <SettingsModal />}
      {notification && <div style={{...s.notif, borderColor: notification.type === 'success' ? '#3fb950' : notification.type === 'error' ? '#f85149' : '#58a6ff'}}>{notification.message}</div>}
    </div>
  );
}

ReactDOM.render(<VocabLabApp />, document.getElementById('root'));
  </script>
</body>
</html>
